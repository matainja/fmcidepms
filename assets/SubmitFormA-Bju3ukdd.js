import{aQ as Ne,aM as pe,j as e,aR as Ae,a0 as V,r as a,u as be,aS as Re,aT as Qe,a2 as ke,p as Pe}from"./index-Duw-MC8m.js";import{H as qe,I as Ke,F as Be}from"./FooterButtonpart-HEz9xqKv.js";import{T as Ee,b as ce}from"./Upload-OoFD4reN.js";import{C as Le,b as C}from"./Tag-CMmnTKqX.js";/* empty css               */import{I as ee,B as z}from"./hoist-non-react-statics.cjs-BwjawDnG.js";import{R as Me,ae as je}from"./Views-D0EagdUL.js";import"./FormContainer-DGeBXD1W.js";import"./Select-ep4hNdnq.js";import{t as le,N as de}from"./toast-D2qmmyN5.js";import{C as Ye,a as We,g as He,b as ze}from"./competency-B4unP_se.js";import{A as Ge}from"./AcknowledgementLayout-Dqdg384Z.js";import"./index-CUh-FhuQ.js";import"./Evidence-D2sau4dz.js";import"./html2canvas.esm-QUj-fub7.js";import"./index-BbBkhP0Q.js";const{TabNav:ie,TabList:Ve}=Ee,Je=()=>{const s=Ne(),r=pe(t=>t.quaterTab.selectedQuarter),l=t=>{s(Ae(t))};return e.jsx("div",{children:e.jsx(Le,{className:"bg-gray-50 card-body-padding mt-8",children:e.jsx(Ee,{value:r,variant:"pill",onChange:l,children:e.jsxs(Ve,{children:[e.jsx(ie,{value:"1",className:`${r==="1"?"bg-green-700 text-white":""}`,children:"First Quarter"}),e.jsx(ie,{value:"2",className:`${r==="2"?"bg-green-700 text-white":""}`,children:"Second Quarter"}),e.jsx(ie,{value:"3",className:`${r==="3"?"bg-green-700 text-white":""}`,children:"Third Quarter"}),e.jsx(ie,{value:"4",className:`${r==="4"?"bg-green-700 text-white":""}`,children:"Fourth Quarter"})]})})})})},Ue=async(s,r,l)=>{try{const t=await V({url:`/form_a?department_id=${s}&team_id=${r}&year=${l}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},Xe=()=>{const[s,r]=a.useState(null),[l,t]=a.useState(!0),[g,i]=a.useState(null);a.useEffect(()=>{(async()=>{try{const j=localStorage.getItem("selectedDepartmentID")||"",x=localStorage.getItem("selectedTeamID"),S=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),T=await Ue(j,x?Number(x):null,S);if(T!=null&&T.data)r(T.data);else throw new Error("Invalid response data")}catch(j){console.error("Error fetching data:",j),i("Failed to load data. Please try again.")}finally{t(!1)}})()},[]);const n={1:0,2:0,3:0,4:0};return{data:s,loading:l,error:g,progress:(s==null?void 0:s.progress)||n}},Ze=()=>{const{data:s,loading:r,error:l,progress:t}=Xe();if(r)return e.jsx("div",{children:"Loading..."});if(l)return e.jsx("div",{className:"text-red-500",children:l});const{department:g,team:i,supervisor:n,staff:h,officer:j}=s||{},x=localStorage.getItem("formPreview_2025");let S;return x&&(S=JSON.parse(x).staff_id),e.jsxs("div",{children:[e.jsx(qe,{department:g,team:i,progress:t,title:"EMPLOYEE PERFORMANCE CONTRACT",downloadButton:!0,staffID:(h==null?void 0:h.staff_id)||S}),h&&n&&j&&e.jsx(Ke,{staff:h,supervisor:n,officer:j}),e.jsx(Je,{})]})};async function er(s){try{return await V({url:`form_a/kras?department_id=${s}`,method:"get"})}catch(r){throw console.error("Error making API request:",r),r}}const{Tr:ye,Th:te,Td:J,THead:rr,TBody:tr}=C,ar=({onClose:s})=>{const r=Ne(),[l,t]=a.useState(""),[g,i]=a.useState([]),[n,h]=a.useState(null),[j,x]=a.useState(!1),[S,T]=a.useState(""),[u,O]=a.useState([]),[A,v]=a.useState(!1),E=be(d=>d.quaterTab.selectedQuarter),K=async()=>{x(!0);try{const d=localStorage.getItem("selectedDepartmentID");if(!d)throw new Error("No department ID selected.");const m=await er(d);i(m.data.data||[])}catch(d){h(d instanceof Error?d.message:"An unknown error occurred.")}finally{x(!1)}};a.useEffect(()=>{K()},[]);const Y=d=>{const m=parseInt(d.target.value,10);t(isNaN(m)?"":m);const b=g.flatMap(Q=>Q.kras).find(Q=>Q.kra_id===m);T(b?b.kra_weight:""),O([])},y=()=>{if(!l)return;const d=g.flatMap(m=>m.kras).find(m=>m.kra_id===l);!d||u.length>=d.objectives.length||O(m=>[...m,{id:Date.now(),selectedObjectiveId:""}])},R=(d,m)=>{O(b=>b.map(Q=>Q.id===d?{...Q,selectedObjectiveId:m}:Q))},f=g.flatMap(d=>d.kras).find(d=>d.kra_id===l),_=f?f.objectives:[],F=u.every(d=>d.selectedObjectiveId!=="")&&u.length>0,W=()=>{if(A)return;const d={[E]:[{kra_name:(f==null?void 0:f.kra_title)||"",kra_weight:S,objectives:u.map(m=>{const b=_.find(Q=>Q.obj_id===parseInt(m.selectedObjectiveId,10));return{objective_name:(b==null?void 0:b.title)||"",objective_weight:Number((b==null?void 0:b.obj_weight)||0),gradeed_weight:Number(S||0),target:(b==null?void 0:b.target)||"",kpi:(b==null?void 0:b.kpi)||"",units:"num",aggregate:"",quarter_marks:0,target_achieved:0,raw:0,weighted:0}})}]};console.log("Confirmed Data:",JSON.stringify(d,null,2)),r(Re(d)),v(!0),setTimeout(()=>{v(!1)},7e3),s()};return j?e.jsx("div",{className:"p-4 text-center",children:"Loading..."}):n?e.jsx("div",{className:"p-4 text-center text-red-600",children:n}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Select KRA"}),e.jsxs("select",{id:"kraSelect",value:l,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white",onChange:Y,children:[e.jsx("option",{value:"",children:"Select a KRA"}),g.map(d=>e.jsx("optgroup",{label:d.heading,children:d.kras.map(m=>e.jsx("option",{value:m.kra_id,children:m.kra_title},m.kra_id))},d.heading))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"weightInput",className:"mb-2 text-sm font-medium text-gray-700",children:"Weight"}),e.jsx(ee,{readOnly:!0,id:"weightInput",value:S,className:"w-full bg-gray-100"})]}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsx(z,{variant:"solid",className:"w-full text-white hover:bg-blue-700",disabled:!l||u.length>=_.length,onClick:y,children:"Add Objective"})})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(C,{compact:!0,className:"border border-gray-400 w-full",children:[e.jsx(rr,{children:e.jsxs(ye,{className:"bg-gray-200",children:[e.jsx(te,{className:"border border-gray-400 p-2",children:"Objective"}),e.jsx(te,{className:"border border-gray-400 p-2",children:"Objective Weight"}),e.jsx(te,{className:"border border-gray-400 p-2",children:"KPI"}),e.jsx(te,{className:"border border-gray-400 p-2",children:"Target"}),e.jsx(te,{className:"border border-gray-400 p-2",children:"Unit of Measurement"})]})}),e.jsx(tr,{children:u.length===0?e.jsx(ye,{children:e.jsx(J,{colSpan:5,className:"text-center text-gray-500 py-4",children:"No Data Found"})}):u.map(d=>{const m=_.find(b=>b.obj_id===parseInt(d.selectedObjectiveId,10));return e.jsxs(ye,{children:[e.jsx(J,{className:"border border-gray-400",children:e.jsxs("select",{className:"w-full bg-white",value:d.selectedObjectiveId,onChange:b=>R(d.id,b.target.value),children:[e.jsx("option",{value:"",children:"Select Objective"}),_.map(b=>e.jsx("option",{value:b.obj_id,children:b.title},b.obj_id))]})}),e.jsx(J,{className:"border border-gray-400",children:(m==null?void 0:m.obj_weight)||""}),e.jsx(J,{className:"border border-gray-400",children:(m==null?void 0:m.kpi)||""}),e.jsx(J,{className:"border border-gray-400",children:(m==null?void 0:m.target)||""}),e.jsx(J,{className:"border border-gray-400",children:(m==null?void 0:m.Responsible)||""})]},d.id)})})]})}),e.jsx("div",{className:"text-right mt-4",children:e.jsx(z,{variant:"solid",disabled:!F||A,className:`${F&&!A?"bg-blue-600":"bg-gray-400"}`,onClick:W,children:"Confirm"})})]})},{Tr:ve,Th:me,Td:ge,THead:sr,TBody:or}=C,cr=[{grade:"O",description:"Outstanding - 100%",quarter:"Q1",value:"First Quarter"},{grade:"E",description:"Excellent - 90%",quarter:"Q2",value:"Second Quarter"},{grade:"VG",description:"Very Good - 80%",quarter:"Q3",value:"Third Quarter"},{grade:"G",description:"Good - 70%",quarter:"Q4",value:"Fourth Quarter"}],nr=()=>{const[s,r]=a.useState(!1),[l,t]=a.useState(!1),[g,i]=a.useState(window.innerWidth<=1024),n=pe(u=>u.quaterTab.selectedQuarter);a.useEffect(()=>{const u=()=>{i(window.innerWidth<=1024)};return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const h=()=>{r(!0)},j=()=>{r(!1)},x=()=>{t(!0)},S=()=>{t(!1)},T=u=>{switch(u){case"1":return"First Quarter";case"2":return"Second Quarter";case"3":return"Third Quarter";case"4":return"Fourth Quarter";default:return"Unknown Quarter"}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"SECTION 3 : EMPLOYEE'S TASKS (70%)"}),e.jsxs("div",{className:"flex space-x-2 ml-auto",children:[e.jsx(z,{className:"mr-2",size:"xs",icon:e.jsx(Me,{}),"aria-label":"Add KRA",onClick:x,children:e.jsx("span",{className:"hidden sm:block",children:"Add KRA"})}),e.jsx(z,{variant:"twoTone",size:"xs",icon:e.jsx(je,{}),"aria-label":"View Scoring Criteria Values",onClick:h,children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Scoring Criteria Values"})})]})]})}),e.jsx(ce,{title:"Vertical Drawer",isOpen:s,placement:"right",width:g?"100%":800,onClose:j,onRequestClose:j,children:e.jsxs(C,{compact:!0,className:"table-auto border-collapse border border-gray-300 w-full text-left mt-4",children:[e.jsx(sr,{children:e.jsxs(ve,{className:"bg-gray-100",children:[e.jsx(me,{className:"border border-gray-300 p-2",children:"Grade"}),e.jsx(me,{className:"border border-gray-300 p-2",children:"Description"}),e.jsx(me,{className:"border border-gray-300 p-2",children:"Quarter"}),e.jsx(me,{className:"border border-gray-300 p-2",children:"Value"})]})}),e.jsx(or,{children:cr.map((u,O)=>e.jsxs(ve,{children:[e.jsx(ge,{className:"border border-gray-300 p-2",children:u.grade}),e.jsx(ge,{className:"border border-gray-300 p-2",children:u.description}),e.jsx(ge,{className:"border border-gray-300 p-2",children:u.quarter}),e.jsx(ge,{className:"border border-gray-300 p-2",children:u.value})]},O))})]})}),e.jsx(ce,{isOpen:l,title:`KRA add for ${T(n)} (${n})`,placement:"right",width:g?"100%":900,onClose:S,children:e.jsx(ar,{onClose:S})})]})},lr=async(s,r,l)=>{try{const t=await V({url:`/employeetask?department_id=${s}&team_id=${r}&year=${l}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},dr=async s=>{try{const r=await V({url:"employeetask",method:"post",data:s});return console.log(r),r}catch(r){throw console.error("Error saving employee task:",r),r}},{Tr:ae,Th:B,Td:$,THead:ir,TBody:mr}=C,gr=({loading:s,data:r,calculateKraWeight:l,calculateGradedWeight:t,totalWeight:g,totalGradedWeight:i})=>e.jsx("div",{children:e.jsxs(C,{compact:!0,className:"border border-gray-400 w-full bg-white",children:[e.jsx(ir,{children:e.jsxs(ae,{className:"bg-gray-200",children:[e.jsx(B,{className:"border border-gray-400 p-2",children:"S/N"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"KRA"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"KRA Weight"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"Objective"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"OBJ Weight"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"Grade Weight"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"Target"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"KPI"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"Unit of Measurement"})]})}),e.jsxs(mr,{children:[s?e.jsx(ae,{children:e.jsx($,{className:"border border-gray-400 text-center",colSpan:9,children:"Loading..."})}):r.length===0?e.jsx(ae,{children:e.jsx($,{className:"border border-gray-400 text-center",colSpan:9,children:e.jsx("span",{className:"text-black font-semibold text-lg",children:"No data available"})})}):r.map((n,h)=>n.objectives.map((j,x)=>e.jsxs(ae,{children:[x===0&&e.jsxs(e.Fragment,{children:[e.jsx($,{className:"border border-gray-400",rowSpan:n.objectives.length,children:h+1}),e.jsx($,{className:"border border-gray-400",rowSpan:n.objectives.length,children:n.kra_name}),e.jsx($,{className:"border border-gray-400 text-center",rowSpan:n.objectives.length,children:l(n.objectives).toFixed(2)})]}),e.jsx($,{className:"border border-gray-400",children:j.objective_name}),e.jsx($,{className:"border border-gray-400",children:j.objective_weight}),e.jsx($,{className:"border border-gray-400 text-center",children:t(j.objective_weight).toFixed(2)}),e.jsx($,{className:"border border-gray-400",children:j.target}),e.jsx($,{className:"border border-gray-400",children:j.kpi}),e.jsx($,{className:"border border-gray-400",children:j.unit})]},`${h}-${x}`))),!s&&r.length>0&&e.jsxs(ae,{children:[e.jsx($,{className:"border border-gray-400 text-center",colSpan:2,children:"Total"}),e.jsx($,{className:"border border-gray-400 text-center",children:"70"}),e.jsx($,{className:"border border-gray-400 text-center"}),e.jsx($,{className:"border border-gray-400 text-center",children:g.toFixed(2)}),e.jsx($,{className:"border border-gray-400 text-center",children:i.toFixed(2)}),e.jsx($,{className:"border border-gray-400 text-center",colSpan:3})]})]})]})}),{Tr:U,Th:L,Td:I,THead:hr,TBody:xr}=C,ur=()=>{const s=Ne(),r=be(c=>c.quaterTab.selectedQuarter),{quater_settings:l}=be(c=>c.auth.user||{});console.log(l);const t=be(c=>c.kra.selectedQuarterData),[g,i]=a.useState({}),[n,h]=a.useState(!0),[j,x]=a.useState(null),[S,T]=a.useState(!1),[u,O]=a.useState(!1),A=2025,v=Number(localStorage.getItem("selectedYear"))||A,E=new Date(new Date().setFullYear(2025)).getFullYear();console.log(E,"hello"),console.log(v,"hi"),console.log("supervisorConfirmed",u);const K=v===A&&E===A&&u;console.log({selectedYear:v,currentYear:E,canEdit:K});const Y=async()=>{var c,o,p;try{const N=localStorage.getItem("selectedDepartmentID"),D=localStorage.getItem("selectedTeamID"),w=await lr(N,D?Number(D):null,v?Number(v):null),P=((c=w==null?void 0:w.data)==null?void 0:c.supervisor_confirmed)===!0||((o=w==null?void 0:w.data)==null?void 0:o.supervisor_confirmation)===!0;O(P),i(((p=w==null?void 0:w.data)==null?void 0:p.result)||{})}catch(N){console.error("Error fetching data:",N),x("Failed to load data. Please try again.")}finally{h(!1)}};a.useEffect(()=>{Y()},[]),console.log("canEdit:",u,!K);const y=!K;console.log("Fetched Employee Task Data:",g,"isReadOnly:",y);const R=a.useMemo(()=>{if(n||!g[r])return[];const c=g[r]||[],o=(t==null?void 0:t[r])||[],p=JSON.parse(JSON.stringify(o));return[...c,...p]},[t,r,g,n]),[f,_]=a.useState([]);a.useEffect(()=>{_(R)},[R]);const F=(c,o,p)=>{if(y)return;const N=c.target.value;if(/^\d{0,2}(\.\d{0,2})?$/.test(N)){const D=[...f];D[o].objectives[p].objective_weight=N,_(D)}else alert("Please enter up to 2 digits before and after the decimal point. Example: 12.75")},W=c=>c.reduce((o,p)=>o+Number(d(p.objective_weight||"0")),0),d=c=>{if(!c||parseFloat(c)===0)return 0;const o=f.reduce((p,N)=>p+N.objectives.reduce((D,w)=>D+parseFloat(w.objective_weight||"0"),0),0);return o===0?0:70/o*parseFloat(c)},m=f.reduce((c,o)=>c+o.objectives.reduce((p,N)=>p+parseFloat(N.objective_weight||"0"),0),0),b=f.reduce((c,o)=>c+o.objectives.reduce((p,N)=>p+Number(d(N.objective_weight||"0")),0),0),Q=c=>{if(y)return;const o=[...f];o.splice(c,1),_(o)},Ie=(c,o)=>{if(y)return;const p=[...f];p[c].objectives.splice(o,1),_(p)},Ce=()=>{if(y)return!1;for(const c of f){if(!c.kra_name||c.kra_name.trim()==="")return alert("KRA name is required."),!1;for(const o of c.objectives){if(!o.objective_name||o.objective_name.trim()==="")return alert("Objective name is required."),!1;if(o.objective_weight===null||o.objective_weight===void 0||isNaN(parseFloat(o.objective_weight)))return alert("Objective weight is required and must be a valid number."),!1;if(o.target===null||o.target===void 0||isNaN(parseFloat(o.target)))return alert("Target is required and must be a valid number."),!1;if(!o.kpi||o.kpi.trim()==="")return alert("KPI is required."),!1}}return!0},$e=async()=>{if(y||!Ce())return;const c=localStorage.getItem("selectedDepartmentID")||"",o=Number(localStorage.getItem("selectedTeamID"))||0,p=Number(localStorage.getItem("selectedYear"))||new Date().getFullYear(),N=Number(r),D=f.reduce((P,fe)=>{const ne=fe.objectives.map(k=>({objective_name:k.objective_name.trim(),objective_weight:parseFloat(k.objective_weight)||0,gradeed_weight:parseFloat(d(k.objective_weight).toFixed(2)),target:parseFloat(k.target)||0,kpi:k.kpi.trim(),unit:k.unit||"",aggregate:k.aggregate||null,quarter_marks:k.quarter_marks||0,target_achieved:k.target_achieved||0,raw:k.raw||0,weighted:k.weighted||0})),q=P.find(k=>k.kra_name===fe.kra_name);return q?q.objective&&Array.isArray(q.objective)?(q.objective.push(...ne),q.kra_weight=q.objective.reduce((k,re)=>k+re.gradeed_weight,0)):(q.objective||(q.objective=[]),q.objective.push(...ne),q.kra_weight=q.objective.reduce((k,re)=>k+re.gradeed_weight,0)):P.push({kra_name:fe.kra_name,kra_weight:ne.reduce((k,re)=>k+re.gradeed_weight,0),objective:ne}),P},[]),w={department_id:c,team_id:o,year:p,quater:N,employee_task:D,total_weight:70,total_graded_weight:b.toFixed(2)};try{const P=await dr({department_id:c,team_id:o,year:p,quater:N,employee_task:w.employee_task,total_weight:70,total_graded_weight:b.toFixed(2)});alert("Data saved successfully!"),Y(),s(Qe())}catch(P){console.error(P),alert("Failed to save data. Please try again.")}},Oe=()=>{if(y)return;const c=parseInt(r);if(c===1)return;const o=(c-1).toString(),p=g[o];if(!p){alert(`No data available in Q${o} to copy`);return}const N=JSON.parse(JSON.stringify(p));i(D=>({...D,[r]:N})),_(N),alert(`Data copied from Q${o} to Q${r}`),T(!0)},Fe=()=>n||f.length>0||y?!1:parseInt(r)>1;return console.log(E),e.jsx("div",{children:K?e.jsxs(e.Fragment,{children:[e.jsxs(C,{compact:!0,className:"border border-gray-400 w-full bg-white",children:[e.jsx(hr,{children:e.jsxs(U,{className:"bg-gray-200",children:[e.jsx(L,{className:"border border-gray-400 p-2",children:"S/N"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"KRA"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"KRA Weight"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"Objective"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"OBJ Weight"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"Grade Weight"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"Target"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"KPI"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"Unit of Measurement"})]})}),e.jsxs(xr,{children:[n?e.jsx(U,{children:e.jsx(I,{className:"border border-gray-400 text-center",colSpan:9,children:"Loading..."})}):f.length===0?Fe()?e.jsx(U,{children:e.jsx(I,{className:"border border-gray-400 text-center",colSpan:9,children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-4",children:[e.jsxs("span",{className:"text-black font-semibold text-lg mb-3",children:["No data for Q",r,". Would you like to copy from previous quarter?"]}),e.jsxs(z,{variant:"solid",className:"w-64",onClick:Oe,disabled:y,children:["Copy from Q",parseInt(r)-1]})]})})}):e.jsx(U,{children:e.jsx(I,{className:"border border-gray-400 text-center",colSpan:9,children:e.jsxs("span",{className:"text-black font-semibold text-lg",children:["No data available for Q",r]})})}):f.map((c,o)=>c.objectives.map((p,N)=>e.jsxs(U,{children:[N===0&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{className:"border border-gray-400",rowSpan:c.objectives.length,children:[o+1,!y&&e.jsx(Ye,{className:"text-xl text-red-600 cursor-pointer",onClick:()=>Q(o)})]}),e.jsx(I,{className:"border border-gray-400",rowSpan:c.objectives.length,children:c.kra_name}),e.jsx(I,{className:"border border-gray-400 text-center",rowSpan:c.objectives.length,children:W(c.objectives).toFixed(2)})]}),e.jsxs(I,{className:"border border-gray-400",children:[!y&&c.objectives.length>2&&e.jsx(We,{className:"text-xl text-red-600 cursor-pointer m-auto",onClick:()=>Ie(o,N)}),e.jsx(ee,{textArea:!0,disabled:y,value:p.objective_name,onChange:D=>{if(y)return;const w=[...f];w[o].objectives[N].objective_name=D.target.value,_(w)}})]}),e.jsx(I,{className:"border border-gray-400",children:e.jsx(ee,{disabled:y,className:"w-full",value:p.objective_weight,onChange:D=>F(D,o,N)})}),e.jsx(I,{className:"border border-gray-400 text-center",children:d(p.objective_weight).toFixed(2)}),e.jsx(I,{className:"border border-gray-400",children:e.jsx(ee,{disabled:y,value:p.target,onChange:D=>{if(y)return;const w=D.target.value;if(/^\d*\.?\d*$/.test(w)){const P=[...f];P[o].objectives[N].target=w,_(P)}}})}),e.jsx(I,{className:"border border-gray-400",children:e.jsx(ee,{disabled:y,textArea:!0,value:p.kpi,onChange:D=>{if(y)return;const w=[...f];w[o].objectives[N].kpi=D.target.value,_(w)}})}),e.jsx(I,{className:"border border-gray-400",children:e.jsx(ee,{disabled:y,textArea:!0,value:p.unit,onChange:D=>{if(y)return;const w=[...f];w[o].objectives[N].unit=D.target.value,_(w)}})})]},`${o}-${N}`))),!n&&f.length>0&&e.jsxs(U,{children:[e.jsx(I,{className:"border border-gray-400 text-center",colSpan:2,children:"Total"}),e.jsx(I,{className:"border border-gray-400 text-center",children:"70"}),e.jsx(I,{className:"border border-gray-400 text-center"}),e.jsx(I,{className:"border border-gray-400 text-center",children:m.toFixed(2)}),e.jsx(I,{className:"border border-gray-400 text-center",children:b.toFixed(2)}),e.jsx(I,{className:"border border-gray-400 text-center",colSpan:3})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end mt-4",children:[S&&!y&&e.jsx("div",{className:"size-10 animate-bounce mb-2 me-5",children:e.jsx("img",{src:"/img/others/down-arrow.svg",alt:"Down Arrow"})}),!y&&e.jsx(z,{variant:"solid",color:"green-700",className:"mt-2",onClick:$e,children:"Save"})]})]}):e.jsx(gr,{loading:n,data:f,calculateKraWeight:W,calculateGradedWeight:d,totalWeight:m,totalGradedWeight:b})})},br=()=>e.jsxs("div",{className:"mt-4",children:[e.jsx(nr,{}),e.jsx(ur,{})]}),{Tr:we,Th:Se,Td:Te,THead:pr,TBody:jr}=C,fr=({isOpen:s,setIsOpen:r})=>{const[l,t]=a.useState(window.innerWidth<=1024);a.useEffect(()=>{const i=()=>{t(window.innerWidth<=1024)};return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const g=[{id:1,title:"Greatly Exceeds Expectations (5)",desc:"Performance far exceeded agreed target(s)..."},{id:2,title:"Exceeds Expectations (4)",desc:"Performance exceeded agreed target(s)..."},{id:3,title:"Meets Expectations (3)",desc:"Performance target(s) achieved..."},{id:4,title:"Occasionally Meets Expectations (2)",desc:"Performance failed to meet expectations..."}];return e.jsx(ce,{isOpen:s,title:"Performance Rating Scale",width:l?"100%":750,onClose:()=>r(!1),children:e.jsxs(C,{compact:!0,className:"w-full text-left mt-4 border border-gray-300",children:[e.jsx(pr,{children:e.jsxs(we,{className:"bg-gray-100",children:[e.jsx(Se,{className:"border border-gray-300 p-2",children:"Title"}),e.jsx(Se,{className:"border border-gray-300 p-2",children:"Description"})]})}),e.jsx(jr,{children:g.map(i=>e.jsxs(we,{children:[e.jsx(Te,{className:"border border-gray-300 p-2",children:i.title}),e.jsx(Te,{className:"border border-gray-300 p-2",children:i.desc})]},i.id))})]})})},yr=()=>{const[s,r]=a.useState(!1);return e.jsxs("div",{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"Section 4 : COMPETENCIES (20%)"}),e.jsx("div",{className:"flex space-x-2 ml-auto",children:e.jsx(z,{variant:"twoTone",size:"xs",icon:e.jsx(je,{}),onClick:()=>r(!0),children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Rating"})})})]})}),e.jsx(fr,{isOpen:s,setIsOpen:r})]})},{Tr:De,Th:he,Td:xe,THead:Nr,TBody:vr}=C,wr=()=>{const[s,r]=a.useState([]),[l,t]=a.useState(!0),[g,i]=a.useState(null),n=async()=>{t(!0),i(null);try{const h=await He();r(h.data||[])}catch(h){console.error("Error fetching data:",h),i("Failed to load data. Please try again.")}finally{t(!1)}};return a.useEffect(()=>{n()},[]),e.jsx("div",{className:"p-2",children:l?e.jsx("div",{className:"text-center text-gray-500",children:"Loading..."}):g?e.jsx("div",{className:"text-center text-red-500",children:g}):s.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No data available."}):e.jsxs(C,{className:"min-w-full border border-gray-300 text-sm",children:[e.jsx(Nr,{className:"bg-gray-200",children:e.jsxs(De,{children:[e.jsx(he,{className:"px-4 py-2 border border-gray-300 text-left",children:"Competency Name"}),e.jsx(he,{className:"px-4 py-2 border border-gray-300 text-left",children:"Cluster"}),e.jsx(he,{className:"px-4 py-2 border border-gray-300 text-left",children:"Sub Cluster"}),e.jsx(he,{className:"px-4 py-2 border border-gray-300 text-left",children:"Description"})]})}),e.jsx(vr,{children:s.map(h=>Object.entries(h.details).map(([j,x])=>x.map((S,T)=>e.jsxs(De,{className:"border-b border-gray-300",children:[T===0&&e.jsx(xe,{rowSpan:x.length,className:"px-4 py-2 border border-gray-300 font-semibold",children:h.competencies_name}),T===0&&e.jsx(xe,{rowSpan:x.length,className:"px-4 py-2 border border-gray-300",children:j}),e.jsx(xe,{className:"px-4 py-2 border border-gray-300",children:S.title}),e.jsx(xe,{className:"px-4 py-2 border border-gray-300",children:S.describe_expectations})]},`${h.competencies_name}-${j}-${T}`))))})]})})},{Tr:X,Th:Z,Td:M,THead:Sr,TBody:Tr}=C,Dr=()=>{const[s,r]=a.useState(!1),[l,t]=a.useState({1:[],2:[],3:[],4:[]}),[g,i]=a.useState(!0),[n,h]=a.useState(null),[j,x]=a.useState(window.innerWidth<=1024);a.useEffect(()=>{const v=()=>{x(window.innerWidth<=1024)};return window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const S=pe(v=>v.quaterTab.selectedQuarter),T=async()=>{i(!0),h(null);try{const v=localStorage.getItem("selectedDepartmentID"),E=localStorage.getItem("selectedTeamID"),K=localStorage.getItem("selectedYear")||new Date().getFullYear(),Y=await ze(v,E?Number(E):null,Number(K));t(Y.data||{1:[],2:[],3:[],4:[]})}catch(v){console.error("Error fetching data:",v),h("Failed to load data. Please try again.")}finally{i(!1)}};a.useEffect(()=>{T()},[]);const u=()=>{r(!0)},O=()=>{r(!1)},A=l[S]||[];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border overflow-hidden shadow-sm bg-white",children:e.jsxs(C,{compact:!0,className:"w-full",children:[e.jsx(Sr,{children:e.jsxs(X,{className:"bg-gray-200",children:[e.jsx(Z,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:e.jsxs("span",{className:"flex items-center gap-1",children:["Competency",e.jsx(je,{className:"text-gray-500 text-xl",onClick:()=>u()})]})}),e.jsx(Z,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:"Cluster"}),e.jsx(Z,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:"Sub Cluster"}),e.jsx(Z,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:"Description"}),e.jsx(Z,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400 w-[8%]",children:"Min"}),e.jsx(Z,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400 w-[8%]",children:"Max"})]})}),e.jsx(Tr,{children:g?e.jsx(X,{children:e.jsx(M,{colSpan:6,className:"p-4 text-center text-gray-500",children:"Loading competency data..."})}):n?e.jsx(X,{children:e.jsx(M,{colSpan:6,className:"p-4 text-center text-red-500",children:n})}):A.length===0?e.jsx(X,{children:e.jsx(M,{colSpan:6,className:"p-4 text-center text-gray-500 font-semibold",children:"No competency data available for the selected quarter."})}):A.map(v=>e.jsxs(ke.Fragment,{children:[e.jsx(X,{children:e.jsx(M,{className:"px-4 py-3 align-top font-semibold border border-gray-400",rowSpan:v.competencies_details.length+1,children:v.competencies})}),v.competencies_details.map(E=>e.jsxs(X,{children:[e.jsx(M,{className:"px-4 py-3 border border-gray-400",children:E.cluster}),e.jsx(M,{className:"px-4 py-3 border border-gray-400",children:E.sub_cluster}),e.jsx(M,{className:"px-4 py-3 border border-gray-400",children:E.describe_expectations}),e.jsx(M,{className:"px-4 py-3 border border-gray-400",children:E.min_score}),e.jsx(M,{className:"px-4 py-3 border border-gray-400",children:E.max_score})]},E.id))]},v.id))})]})}),e.jsx(ce,{title:"Competency Information",width:j?"100%":800,isOpen:s,onClose:O,children:e.jsx(wr,{})})]})},_r=()=>e.jsxs("div",{className:"mt-8",children:[e.jsx(yr,{}),e.jsx(Dr,{})]}),{Tr:se,Th:_e,Td:H,THead:kr,TBody:Er}=C,Ir=()=>{const[s,r]=a.useState(!1),[l,t]=a.useState(window.innerWidth<=1024);a.useEffect(()=>{const n=()=>{t(window.innerWidth<=1024)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const g=()=>{r(!0)},i=n=>{console.log("onDrawerClose",n),r(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"Section 5 : OPERATIONS AND PROCESSES (10%)"}),e.jsx("div",{className:"flex space-x-2 ml-auto",children:e.jsx(z,{onClick:()=>g(),variant:"twoTone",size:"xs",icon:e.jsx(je,{}),children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Rating"})})})]})}),e.jsx(ce,{title:"Performance Rating Scale  ",isOpen:s,width:l?"100%":750,onClose:i,onRequestClose:i,children:e.jsxs(C,{compact:!0,className:"table-auto border-collapse border border-gray-300 w-full text-left mt-4",children:[e.jsx(kr,{children:e.jsxs(se,{className:"bg-gray-100",children:[e.jsx(_e,{className:"border border-gray-300 p-2",children:"Title"}),e.jsx(_e,{className:"border border-gray-300 p-2",children:"Description"})]})}),e.jsxs(Er,{children:[e.jsxs(se,{children:[e.jsx(H,{className:"border border-gray-300 p-2",children:"Greatly Exceeds Expectations (5)"}),e.jsx(H,{className:"border border-gray-300 p-2",children:"Performance far exceeded agreed target(s) on all critical parameters on a consistent basis; overall quality of work and performance is excellent."})]}),e.jsxs(se,{children:[e.jsx(H,{className:"border border-gray-300 p-2",children:"Exceeds Expectations (4)"}),e.jsx(H,{className:"border border-gray-300 p-2",children:"Performance exceeded agreed target(s) on all critical parameters; overall quality of work and performance is very good."})]}),e.jsxs(se,{children:[e.jsx(H,{className:"border border-gray-300 p-2",children:"Meets Expectations (3)"}),e.jsx(H,{className:"border border-gray-300 p-2",children:"Performance target(s) achieved on all critical parameters; overall quality of work and performance is good."})]}),e.jsxs(se,{children:[e.jsx(H,{className:"border border-gray-300 p-2",children:"Occasionally Meets Expectations (2)"}),e.jsx(H,{className:"border border-gray-300 p-2",children:"Performance failed to meet expectations on agreed target(s) and on some critical parameters; performance deficiencies can however be addressed with support through guidance, coaching, mentoring and/ or training."})]})]})]})})]})},{Tr:oe,Th:ue,Td:G,THead:Cr,TBody:$r}=C,Or=({filteredData:s,error:r,loading:l})=>e.jsxs(C,{compact:!0,className:"table-auto border-collapse border border-gray-400 w-full bg-white",children:[e.jsx(Cr,{children:e.jsxs(oe,{className:"bg-gray-200",children:[e.jsx(ue,{className:"border border-gray-400 p-2 text-center align-middle",children:"Operations and Processes"}),e.jsx(ue,{className:"border border-gray-400 p-2 text-center align-middle",children:"Describe Expectations"}),e.jsx(ue,{className:"border border-gray-400 p-2 text-center align-middle",children:"Min Score"}),e.jsx(ue,{className:"border border-gray-400 p-2 text-center align-middle",children:"Max Score"})]})}),e.jsx($r,{children:l?e.jsx(oe,{children:e.jsx(G,{colSpan:4,className:"p-4 text-center text-gray-500",children:"Loading competency data..."})}):r?e.jsx(oe,{children:e.jsx(G,{colSpan:4,className:"p-4 text-center text-red-500",children:r})}):s.length===0?e.jsx(oe,{children:e.jsx(G,{colSpan:4,className:"p-4 text-center text-gray-500 font-semibold",children:"No competency data available for the selected quarter."})}):s.map((t,g)=>e.jsx(ke.Fragment,{children:t.details.map((i,n)=>e.jsxs(oe,{children:[n===0&&e.jsx(G,{className:"border border-gray-400 p-2 font-bold",rowSpan:t.details.length,children:t.operations_and_process}),e.jsx(G,{className:"border border-gray-400 p-2",children:i.describe_expectations}),e.jsx(G,{className:"border border-gray-400 p-2 text-center",children:i.min_score}),e.jsx(G,{className:"border border-gray-400 p-2 text-center",children:i.max_score})]},n))},g))})]}),Fr=async(s,r,l)=>{try{const t=await V({url:`/operation_and_process?department_id=${s}&team_id=${r}&year=${l}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},Ar=()=>{const[s,r]=a.useState([]),[l,t]=a.useState(""),[g,i]=a.useState(!0),n=async()=>{try{const x=localStorage.getItem("selectedDepartmentID"),S=localStorage.getItem("selectedTeamID"),T=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),u=await Fr(x,S?Number(S):null,T?Number(T):null);r(u.data||{})}catch(x){console.error("Error fetching data:",x),t("Failed to load data. Please try again.")}finally{i(!1)}};a.useEffect(()=>{n()},[]);const h=pe(x=>x.quaterTab.selectedQuarter),j=s[h];return console.log(j),e.jsxs("div",{className:"mt-8",children:[e.jsx(Ir,{}),e.jsx(Or,{filteredData:j||[],error:l,loading:g})]})},Rr=async(s,r,l)=>{try{const t=await V({url:`/form_a_comments?department_id=${s}&team_id=${r}&year=${l}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},Qr=async s=>{try{const r=await V({url:"/form_a_comments",method:"post",data:s});return console.log(r),r}catch(r){throw console.error("Error fetching information data:",r),r}},Pr=()=>{const s=Pe(),[r,l]=a.useState(null),[t,g]=a.useState(!0),[i,n]=a.useState(null),[h,j]=a.useState([]),[x,S]=a.useState(""),[T,u]=a.useState(!1),[O,A]=a.useState({declaration:null,date:null,signature:null,flag:0}),v=a.useRef(null);a.useEffect(()=>{(async()=>{try{const R=localStorage.getItem("selectedDepartmentID")||"",f=localStorage.getItem("selectedTeamID"),_=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),F=await Rr(R,f?Number(f):null,_);if(F&&F.data)l(F.data);else throw new Error("Invalid response data")}catch(R){console.error("Error fetching data:",R),n("Failed to load data. Please try again.")}finally{g(!1)}})()},[]);const E=async()=>{var y,R,f,_;if(!x.trim()){u(!0),(y=v.current)==null||y.scrollIntoView({behavior:"smooth",block:"center"}),(R=v.current)==null||R.focus(),le.push(e.jsx(de,{type:"warning",children:"Appraisee's Comments is required"}),{placement:"top-center"});return}u(!1);try{const F=O.date instanceof Date?O.date.toISOString().split("T")[0]:null,W={department_id:localStorage.getItem("selectedDepartmentID")||"",team_id:localStorage.getItem("selectedTeamID"),year:localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),evidence_ids:h,comment:x,date:F,signature:O.signature,declaration:O.declaration,flag:O.flag};(await Qr(W)).status===200?le.push(e.jsx(de,{title:"Success",type:"success",children:"Data submitted successfully!"}),{placement:"top-center"}):le.push(e.jsx(de,{title:"Error",type:"danger",children:"Unexpected server response"}),{placement:"top-center"})}catch(F){const W=((_=(f=F.response)==null?void 0:f.data)==null?void 0:_.error)||F.message||"An unexpected error occurred.";le.push(e.jsx(de,{title:"Error",type:"danger",children:W}),{placement:"top-center"})}},K=()=>s(-1),Y=()=>s("/form/review");return t?e.jsx("div",{children:"Loading..."}):i?e.jsx("div",{className:"text-red-500",children:i}):e.jsxs("div",{className:"mt-4 mx-auto w-full",children:[e.jsx(Ge,{data:r,commentInputRef:v,setSelectedEvidenceIds:j,setCommentText:S,showValidationError:T,setDeclarationData:A}),e.jsx(Be,{back:"Back",handleBack:K,save:"Save",handleSave:E,next:"Next",handleNext:Y})]})},rt=()=>e.jsxs("div",{children:[e.jsx(Ze,{}),e.jsx(br,{}),e.jsx(_r,{}),e.jsx(Ar,{}),e.jsx(Pr,{})]});export{rt as default};
